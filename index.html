<!DOCTYPE html>
<html>
<head>
  <title>Absensi Otomatis Aldo</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
    }
    .log {
      margin-top: 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>Absensi Kehadiran</h1>
  <input type="text" id="inputNama" placeholder="Masukkan nomor/nama"><br>
  <button onclick="absenMasuk()">Masuk</button>
  <div class="log" id="log"></div>

  <script>
    // ✅ GUNAKAN LINK CSV, bukan pubhtml
    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSk7IfXJ8PeG6s0rY-kGZwNUmjZHixJw2FruQLzUVmeWDw3MaM6EFTeLi2CtP4iTDN-DHJpnCI3aIi0/pub?output=csv&gid=835708808';

    async function absenMasuk() {
      const input = document.getElementById("inputNama").value.trim().toLowerCase();
      const log = document.getElementById("log");

      if (!input) {
        log.innerText = "⚠️ Masukkan nama atau nomor absen terlebih dahulu!";
        return;
      }

      log.innerText = "🔄 Memeriksa daftar absen...";

      try {
        const res = await fetch(sheetURL);
        const csvText = await res.text();
        const rows = csvText.split("\n").map(row => row.split(","));

        // Lewati baris header, mulai dari baris ke-2
        let ditemukan = false;
        for (let i = 1; i < rows.length; i++) {
          const absen = rows[i][0]?.trim().toLowerCase();
          const nama = rows[i][1]?.trim().toLowerCase();

          if (input === absen || input === nama) {
            const now = new Date();
            const waktu = now.toLocaleString("id-ID");
            log.innerText = `✅ ${rows[i][0]} - ${rows[i][1]} tercatat hadir pada ${waktu}`;
            ditemukan = true;
            break;
          }
        }

        if (!ditemukan) {
          log.innerText = "❌ Nama atau nomor absen tidak ditemukan!";
        }
      } catch (err) {
        log.innerText = "⚠️ Gagal mengambil data dari spreadsheet.";
        console.error(err);
      }
    }
  </script>
</body>
</html>
